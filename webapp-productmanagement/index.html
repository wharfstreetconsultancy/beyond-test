<html>
  <head>
    <meta charset="utf-8">
    <title>Suroor Fashions - Product Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/main.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel='shortcut icon' type='image/x-icon' href='img/favicon.jpg'/>
  </head>
  <body onLoad="{onload.action}">
    <!------------------------------ Header --------------------------->
    <!--This is the Header Content-->
  	<div class="container-fluid">
  		<div class="row">
  			<div class="col-sm-1 header">
  				<div class="col-xs-1 col-md-1 col-lg-1 text-center">
  					<a href="/"><img src="img/SVGlogo.svg" class="img" alt="Suroor Fashions - Product Management"></a>
  				</div>
  			</div>
  		</div>
        </div>
  	<nav class="navbar navbar-default">
  		  <div class="container-fluid nav-con">
  			<!--Brand and toggle get grouped for better mobile display-->
  			<div class="navbar-header">
  				<div class="col-sm-1 header">
  				  <button type="button" class="navbar-toggle x collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
  					<span class="sr-only">Toggle navigation</span>
  					<span class="icon-bar"></span>
  					<span class="icon-bar second-bar"></span>
  				  </button>
  			  	</div>
  			</div>
  			<!--Collect the nav links, forms, and other content for toggling-->
  			<div class="collapse navbar-collapse cool-nav" id="bs-example-navbar-collapse-1">Product Management</div>
  		  </div>
    </nav>


    <!---------------------------Body ------------------------->
		<div class="body container">


			<div class="row">
			
			
				<div class="col-md-3">
					<form id="product_catalog">
						<div class="row">
							<h1>Product Catalog</h1>
							**displayed in showcase carousel<br>
						</div>
						<div class="row">
							<h2>Clothing Products</h2>
			                {products.list.clothing}
						</div>
						<div class="row">
							<h2>Jewellery Products</h2>
			                {products.list.jewellery}
						</div>
	                </form>
				</div>
				
				
				<div class="col-md-9">
				
				
					<!-- Title -->
					<form id="product_details" action="/" method="post" enctype="multipart/form-data">
						<input id="id" type="hidden" name="id"/>
						<input id="creationTimestamp" type="hidden" name="creationTimestamp"/>
						<input id="colors" type="hidden" name="colors"/>
						<input id="sizes" type="hidden" name="sizes"/>
						<input id="images" type="hidden" name="images"/>
						<div class="row pull-top">
							<!-- div class="col-lg-12" -->
								<table width="100%"><tr><td>
									<h1>Product Details</h1>
									{user.prompt}
								</td><td align="right">
									<input id="post" name="action" type="submit" class="btn btn-primary" value="Create"/><input id="put" name="action" type="submit" class="btn btn-primary" value="Update"/><!-- input id="delete" name="action" type="submit" class="btn btn-primary" value="Delete"/ --><input id="reset_forms" type="reset" class="btn btn-primary" value="Clear"/><br>
								</td></tr></table>
							<!-- /div -->
						</div>
						<hr>
						<div class="row">
						
						
							<div class="col-md-9">
								<div class="panel panel-primary">
									<div class="panel-heading">Product Details</div>
									<div class="panel-body">
										<b>Name:</b><br>
										<input id="name" type="text" name="name"><br>
										<b>Description:</b><br>
										<input id="description" type="text" name="description"><br>
										<b>Price:</b><br>
										<input id="price" type="text" name="price"><br>
										<b>Type:</b><br>
										<input id="type_clothing" type="radio" name="type" value="CLOTHING" checked> Clothing<br>
										<input id="type_jewellery" type="radio" name="type" value="JEWELLERY"> Jewellery<br>
										<b>Status:</b><br>
										<input id="promoted" type="checkbox" name="promoted" value="true"> On Promotion<br>
									</div>
									<div class="panel-footer"></div>
								</div>
							<!-- /div>
							<div class="col-sm-4" -->
								<div class="panel panel-primary">
									<div class="panel-heading">Color Attribute Values</div>
									<div class="panel-body">
										<span id="color_config" class="pull-top"></span>
										<input id="color" type="text" name="color" size="20" class="pull-left"/>
										<input id="add_color" name="add_color" type="submit"
												value="Add" class="btn btn-secondary pull-right"/>
									</div>
									<div class="panel-footer"></div>
								</div>
							<!-- /div>
							<div class="col-sm-4" -->
								<div class="panel panel-primary">
									<div class="panel-heading">Size Attribute Values</div>
									<div class="panel-body">
										<span id="size_config" class="pull-top"></span>
										<input id="size" type="text" name="size" size="20" class="pull-left"/>
										<input id="add_size" name="add_size" type="submit"
												value="Add" class="btn btn-secondary pull-right"/>
									</div>
									<div class="panel-footer"></div>
								</div>
							</div>


					</form>
							
							
						<div class="col-md-3">
							<!-- div class="col-sm-4" -->
								<div class="panel panel-primary">
									<div class="panel-heading">Product Images</div>
									<div class="panel-body">
										<form id="product_image" method="post" enctype="multipart/form-data">
											<input id="image_loc" type="hidden" name="image_loc" />
											<input id="image_tag" type="hidden" name="image_tag" />
											<div class="pull-top">
												<span id="image_upload_button"></span><br> <span id="image_upload_selector"></span>
											</div>
											<hr>
											<div class="pull-left">
												<span id="image_delete_button"></span><br>
												<span id="image_list"></span>
											</div>
											<div class="pull-right">
												<span id="default_image_selector"></span><br>
												<span id="selected_image_view"></span>
											</div>
										</form>
									</div>
									<div class="panel-footer"></div>
								</div>
							<!-- /div -->
						</div>


						</div> <!-- End row -->
						
					
				</div> <!-- End col-sm-6 -->
				
				
			</div> <!-- End row -->


		</div>

		<!------------------------------- Footer --------------------->
		<footer>
			<div class="container-fluid pull-bottom">
				<div class="footer">
					<p class="copyright">&copy 2017 Suroor Fashions | All Rights
						Reserved</p>
					<p class="links">
						<a href="#">Terms of use </a>
					</p>
					<span class="links">|</span>
					<p class="links">
						<a href="#">Privacy Policy </a>
					</p>
					<span class="links">|</span>
					<p class="links">
						<a href="#">Sales & Return Policy</a>
					</p>
				</div>
			</div>
		</footer>

		<!-- Latest compiled and minified JavaScript -->
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/3.51/jquery.form.min.js"></script>
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	    <script>
function reloadProduct(product, callback) {
	$.get('/product/'+product.id, function(product, status){
		displayProduct(product, function () {
			selectProduct(JSON.parse(document.getElementById(product.id).value), function() {
				callback();
			});
		});
	});
}

function displayProduct(product, callback) {
	document.getElementById(product.id+'_div').innerHTML = '<input id=\''+product.id+'\' type=\'radio\' name=\'product\' value=\''+JSON.stringify(product)+'\' onclick=\'selectProduct(JSON.parse(this.value));\'> '+product.name+'</input><br>Created on...<br>';
	callback();
}

function displayProductAttributes(attributes, attributeName, attributeHtmlElement, callback) {
	if(attributes) {
		for(var attribute of attributes) {
			attributeHtmlElement.innerHTML += '<input id=\''+attribute+'\' type=\'radio\' name=\''+attributeName+'\' value=\''+attribute+'\'> '+attribute+'</input><br>';
		}
	}
	callback();
}

function displayProductSizes(sizes, callback) {
	if(sizes) {
		for(var size of sizes) {
			document.getElementById('size_config').innerHTML += '<input id=\''+size+'\' type=\'radio\' name=\'size\' value=\''+size+'\'> '+size+'</input><br>';
		}
		callback();
	}
}

function displayProductImages(images, callback) {
	document.getElementById('image_list').innerHTML = '';
        var imageCounter = 1;
        if(images) {
                for(var image of images) {
                        document.getElementById('image_list').innerHTML += '<input id=\''+image.tag+'\' type=\'radio\' name=\'selected_image\' value=\''+JSON.stringify(image)+'\' onclick=\'selectImage(JSON.parse(this.value))\'> Image '+(imageCounter++)+'</input><br>';
                }
        }
	callback();
}

function selectProduct(selectedProduct, callback) {
	console.log("Product just selected: "+JSON.stringify(selectedProduct));
	document.getElementById('reset_forms').click();
	document.getElementById(selectedProduct.id).checked = true;
	document.getElementById('id').value = selectedProduct.id;
	document.getElementById('creationTimestamp').value = selectedProduct.creationTimestamp;
	document.getElementById('name').value = selectedProduct.name;
	document.getElementById('description').value = selectedProduct.description;
	document.getElementById('price').value = selectedProduct.price;
        document.getElementById('type_'+selectedProduct.type.toLowerCase()).checked = true;
        document.getElementById('promoted').checked = selectedProduct.promoted;
        document.getElementById('product_image').action = '/product/'+selectedProduct.id+'/image';
        document.getElementById('colors').value = JSON.stringify(selectedProduct.colors);
        document.getElementById('sizes').value = JSON.stringify(selectedProduct.sizes);
        document.getElementById('images').value = JSON.stringify(selectedProduct.images);
	document.getElementById('image_upload_selector').innerHTML = '<input id=\'image_files\' name=\'image_files\' type=\'file\'/>';
        document.getElementById('image_upload_button').innerHTML = '<input id=\'image_upload\' name=\'image_upload\' type=\'submit\' value=\'Upload\' class=\'btn btn-secondary\'/>';
        // document.getElementById('image_delete_button').innerHTML = '<input id=\'image_delete\' name=\'image_delete\' type=\'submit\' value=\'Delete\' onsubmit=\'return false;\' class=\'btn btn-secondary\'/>';
	displayProductAttributes(selectedProduct.colors, 'color', document.getElementById('color_config'), function() {
		displayProductAttributes(selectedProduct.sizes, 'size', document.getElementById('size_config'), function() {
			displayProductImages(selectedProduct.images, function() {
				if(callback) {
					callback();
				} else {
					getDefaultImage(selectedProduct, function (defaultImage) {
						selectImage(defaultImage);
					});
				}
			});
		});
	});
}

function selectImage(selectedImage) {
        console.log("Image just selected: "+JSON.stringify(selectedImage));
        document.getElementById('selected_image_view').innerHTML = '<img id=\'selected_image\' width=\'150\' src=\''+selectedImage.location+'\'/>';
        document.getElementById('image_loc').value = selectedImage.location;
        document.getElementById('image_tag').value = selectedImage.tag;
	document.getElementById('default_image_selector').innerHTML = '<input id=\'default_image\' type=\'checkbox\' value=\''+selectedImage.tag+'\'> (default image)</input>';
	document.getElementById('default_image').checked = selectedImage.isDefault;
	document.getElementById(selectedImage.tag).checked = true;
}

function getSelectedProduct(callback) {
        for(var product of document.getElementById('product_catalog')) {
                if(product.checked) {
                        console.log("Currently selected product: "+product.value);
			callback(JSON.parse(product.value));
                }
        }
}

function getSelectedImage(callback) {
        for(var image of document.getElementsByName('selected_image')) {
                if(image.checked) {
                        console.log("Currently selected image: "+image.value);
                        callback(JSON.parse(image.value));
                }
        }
}

function getDefaultImage(product, callback) {
        if(product.images) {
		for(var image of product.images) {
	                if(image.isDefault) {
                        	callback(image);
                	}
        	}
	}
}

$(document).ready(function() {
        $('#add_color').click(function () {
                var selectedColor = document.getElementById('color').value;
		if(selectedColor) {
			selectedColor = selectedColor.toUpperCase();
			var colors = document.getElementById('colors').value;
			var existingColors = (colors) ? JSON.parse(colors) : [];
			existingColors.push(selectedColor);
			document.getElementById('colors').value = JSON.stringify(existingColors);
			document.getElementById('color_config').innerHTML += '<input id=\''+selectedColor+'\' type=\'radio\' name=\'selected_color\' value=\''+selectedColor+'\'> '+selectedColor+'</input><br>';
			document.getElementById(selectedColor).checked = true;
		}		
		return false;
        });
        $('#add_size').click(function () {
                var selectedSize = document.getElementById('size').value;
                if(selectedSize) {
                        selectedSize = selectedSize.toUpperCase();
			var sizes = document.getElementById('sizes').value;
			var existingSizes = (sizes) ? JSON.parse(sizes) : [];
			existingSizes.push(selectedSize);
			document.getElementById('sizes').value = JSON.stringify(existingSizes);
			document.getElementById('size_config').innerHTML += '<input id=\''+selectedSize+'\' type=\'radio\' name=\'selected_size\' value=\''+selectedSize+'\'> '+selectedSize+'</input><br>';
			document.getElementById(selectedSize).checked = true;
                }
                return false;
        });
	$('#default_image_selector').on('click', '#default_image', function () {
		if(this.checked == false) {
			alert("Must have default image at all times");
			this.checked = true;
			return false;
		}
		var newDefaultImageTag = this.value;
		getSelectedProduct(function (product) {
			for(var image of product.images) {
				if(image.tag == newDefaultImageTag) {image.isDefault = true;}
				else {image.isDefault = false;}
			}
			displayProduct(product, function() {
				selectProduct(product);
				return true;
			});
		});
        });
	$('#reset_forms').click(function () {
		for(var form of document.forms) {
			form.reset();
		}
		document.getElementById('image_list').innerHTML = '';
		document.getElementById('default_image_selector').innerHTML = '';
		document.getElementById('image_upload_selector').innerHTML = '';
                document.getElementById('image_upload_button').innerHTML = '';
                document.getElementById('image_delete_button').innerHTML = '';
		document.getElementById('selected_image_view').innerHTML = '';
		document.getElementById('color_config').innerHTML = '';
		document.getElementById('size_config').innerHTML = '';
		return true;
        });
        $('#product_image').submit(function () {
		$('#status').empty().text('File is uploading...');
                $(this).ajaxSubmit({
                        error: function (xhr) {
                                status('Error: ' + xhr.status);
                                console.log("File upload error: "+xhr.status);
                        },
                        success: function (image) {
                                $('#status').empty().text(image);
                                console.log("File upload success: "+JSON.stringify(image));
                                getSelectedProduct(function (selectedProduct) {
                                        reloadProduct(selectedProduct, function () {
                                                selectImage(JSON.parse(document.getElementById(image.tag).value));
                                        });
                                });
                        }
                });
                return false;
        });
});
		</script>
	</body>
</html>
